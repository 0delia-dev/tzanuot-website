<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>×¦× ×•×¢×•×ª - ××§×•× ×œ××¦×™××ª ×‘×’×“×™× ×¦× ×•×¢×™×</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="×× ×’× ×•×Ÿ ×—×™×¤×•×© ×•×¡×™× ×•×Ÿ ×œ×‘×’×“×™× ×¦× ×•×¢×™× ×‘××•×¤×Ÿ ××•×ª×× ×œ×›×œ ××—×ª ×”××‘×•×¡×¡ ×¢×œ ×××’×¨ ×©××ª××œ× ×¢×œ ×™×“×™ ××©×ª××©×™×" />
  <meta name="keywords" content="×¦× ×™×¢×•×ª, ××•×¤× ×”, × ×©×™×, ×‘×’×“×™×, ×”×œ×›×”" />
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="container">
      <h1 class="logo">×¦× ×•×¢×•×ª</h1>
      <nav class="nav">
        <button class="nav-btn active" data-tab="home">×‘×™×ª</button>
        <button class="nav-btn" data-tab="gallery">×’×œ×¨×™×”</button>
        <button class="nav-btn" data-tab="add-item">×”×•×¡×¤×ª ×‘×’×“</button>
        <button class="nav-btn" data-tab="forum">×¤×•×¨×•×</button>
        <button class="nav-btn" data-tab="tzniut-forum">×¤×•×¨×•× ×¦× ×™×¢×•×ª</button>
        <button class="nav-btn" data-tab="about">××•×“×•×ª</button>
      </nav>
    </div>
  </header>

  <main class="main">
      <section id="home" class="tab-content active">
          <div class="hero">
              <div class="container">
                  <h2 class="hero-title">×‘×¨×•×›×•×ª ×”×‘××•×ª ×œ×¦× ×•×¢×•×ª</h2>
                  <p class="hero-subtitle"> ×”××§×•× ×œ×¡×™× ×•×Ÿ ×‘×’×“×™× ×™×¤×™× ×•×¦× ×•×¢×™× ×‘×©×‘×™×œ×š ×•×‘×¢×–×¨×ª×š</p>
                  <button class="btn btn-primary" onclick="switchTab('gallery')">×¦×¤×™ ×‘×’×œ×¨×™×”</button>
              </div>
          </div>
      </section>

      <section id="gallery" class="tab-content">
          <div class="container">
              <h2>×’×œ×¨×™×™×ª ×‘×’×“×™×</h2>
              <div class="filters">
                  <select id="sleeve-filter">
                      <option value="">×›×œ ×”×©×¨×•×•×œ×™×</option>
                      <option value="long">××¨×•×š</option>
                      <option value="3quarter">3/4</option>
                      <option value="short">×§×¦×¨</option>
                  </select>
                  <select id="skirt-filter">
                      <option value="">×›×œ ×”×—×¦××™×•×ª</option>
                      <option value="long">××¨×•×›×”</option>
                      <option value="midi">××™×“×™</option>
                      <option value="short">×§×¦×¨×”</option>
                  </select>
                  <select id="collar-filter">
                      <option value="">×›×œ ×”×¦×•×•××¨×•× ×™×</option>
                      <option value="high">×’×‘×•×”</option>
                      <option value="round">×¢×’×•×œ</option>
                      <option value="low">× ××•×š</option>
                  </select>
                  <select id="pockets-filter">
                      <option value="">×›×™×¡×™×</option>
                      <option value="yes">×™×© ×›×™×¡×™×</option>
                      <option value="no">××™×Ÿ ×›×™×¡×™×</option>
                  </select>
              </div>
              <div id="items-grid" class="items-grid"></div>
          </div>
      </section>

      <section id="add-item" class="tab-content">
          <div class="container">
              <h2>×”×•×¡×™×¤×™ ×‘×’×“ ×—×“×©</h2>
              <form id="add-item-form" class="form">
                  <input type="text" id="item-title" placeholder="×©× ×”×‘×’×“" required>
                  <input type="url" id="item-url" placeholder="×§×™×©×•×¨ ×œ×‘×’×“" required>
                  <select id="sleeve-length" required>
                      <option value="">×‘×—×¨×™ ××•×¨×š ×©×¨×•×•×œ</option>
                      <option value="long">××¨×•×š</option>
                      <option value="3quarter">3/4</option>
                      <option value="short">×§×¦×¨</option>
                  </select>
                  <select id="skirt-length" required>
                      <option value="">×‘×—×¨×™ ××•×¨×š ×—×¦××™×ª</option>
                      <option value="long">××¨×•×›×”</option>
                      <option value="midi">××™×“×™</option>
                      <option value="short">×§×¦×¨×”</option>
                  </select>
                  <select id="collar-type" required>
                      <option value="">×‘×—×¨×™ ×¡×•×’ ×¦×•×•××¨×•×Ÿ</option>
                      <option value="high">×’×‘×•×”</option>
                      <option value="round">×¢×’×•×œ</option>
                      <option value="v">×•×™</option>
                  </select>
                  <label class="checkbox-label">
                      <input type="checkbox" id="has-pockets">
                      ×™×© ×›×™×¡×™×
                  </label>
                  <textarea id="item-description" placeholder="×ª×™××•×¨ (××•×¤×¦×™×•× ×œ×™)"></textarea>
                  
                  <!-- Honeypot Fields -->
                  <div class="honeypot-field" aria-hidden="true">
                      <label for="website">××ª×¨ ××™× ×˜×¨× ×˜:</label>
                      <input type="text" id="website" name="website" tabindex="-1" autocomplete="off">
                  </div>
                  
                  <!-- CAPTCHA -->
                  <div class="captcha-container">
                      <label for="captcha">×‘×¢×™×” ×¤×©×•×˜×”:</label>
                      <div id="captcha-question"></div>
                      <input type="number" id="captcha-answer" placeholder="×ª×©×•×‘×”" required>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">×”×•×¡×™×¤×™ ×‘×’×“</button>
              </form>
          </div>
      </section>

      <section id="forum" class="tab-content">
          <div class="container">
              <h2>×¤×•×¨×•× ×©××œ×•×ª ×•×ª×©×•×‘×•×ª</h2>
              <button id="ask-question-btn" class="btn btn-secondary">×©××œ×™ ×©××œ×” ×—×“×©×”</button>
              <form id="ask-question-form" class="form" style="display: none;">
                  <input type="text" id="question-title" placeholder="×›×•×ª×¨×ª ×”×©××œ×”" required>
                  <textarea id="question-content" placeholder="×ª×•×›×Ÿ ×”×©××œ×”" required></textarea>
                  <div class="captcha-container">
                      <label for="question-captcha">×‘×¢×™×” ×¤×©×•×˜×”:</label>
                      <div id="question-captcha-question"></div>
                      <input type="number" id="question-captcha-answer" placeholder="×ª×©×•×‘×”" required>
                  </div>
                  <div class="form-actions">
                      <button type="submit" class="btn btn-primary">×¤×¨×¡××™ ×©××œ×”</button>
                      <button type="button" class="btn btn-secondary" onclick="hideQuestionForm()">×‘×™×˜×•×œ</button>
                  </div>
              </form>
              <div id="forum-posts" class="forum-posts"></div>
          </div>
      </section>

      <section id="tzniut-forum" class="tab-content">
          <div class="container">
              <h2>×¤×•×¨×•× ×¦× ×™×¢×•×ª</h2>
              <p class="subtitle">×¦×™×˜×•×˜×™× ×•××—×©×‘×•×ª ×¢×œ ×¦× ×™×¢×•×ª ××”×•×’×•×ª ×“×ª×™×•×ª ××›×•×‘×“×•×ª</p>
              <div id="tzniut-quotes" class="quotes-container"></div>
          </div>
      </section>

      <section id="about" class="tab-content">
          <div class="container">
              <h2>××•×“×•×ª ×”××™×–×</h2>
              <div class="about-content">
                  <p>×”×™×™!</p>
                     <p> ×× ×™ ××•×“×œ×™×”, ×•×××– ×•××ª××™×“ ×”×—×•×•×™×” ×”×©× ×•××” ×¢×œ×™×™ ×œ×¤× ×™ ×”×—×’ ×”×™×™×ª×” ×”×—×™×¤×•×©. ×—×™×¤×•×© ××—×¨×™ ×‘×’×“ ×©×”×•× ×™×¤×” ×•××× ×ª××©×¨ ××ª ×”×¦× ×™×¢×•×ª. ×–×” ×”×™×” ××•×‘×Ÿ ×××œ×™×• ×‘×©×‘×™×œ×™ - ××‘×œ ×œ××” ×‘×¢×¦×?</p>
                  
                  <p>××ª×•×š ×”×”×‘× ×” ×”×–×• ×”×§××ª×™ ××ª ×”××™×–× ×”×–×”, ×¦× ×•×¢×•×ª.</p>
                  
                  <h3>××” ×× ×—× ×•?</h3>
                  <p>××™×–× "×¦× ×•×¢×•×ª" × ×•×œ×“ ××ª×•×š ×—×•×•×™×” ××™×©×™×ª - ×”×§×•×©×™ ×”×™×•××™×•××™ ×‘××¦×™××ª ×‘×’×“×™× ××ª××™××™× ××‘×œ×™ ×œ×‘×–×‘×– ×©×¢×•×ª ××™× ×¡×•×¤×™×•×ª ×‘×—×™×¤×•×©. ×× ×™ ××›×™×¨×” ××ª ×”×ª×—×•×©×” ×”×–×• ×”×™×˜×‘ - ×œ×”×™×›× ×¡ ×œ×—× ×•×ª ××—×¨ ×—× ×•×ª, ×œ×’×œ×•×© ×‘××ª×¨ ××—×¨ ××ª×¨, ×•×‘×¡×•×£ ×œ××¦×•× ×¨×§ ×—×œ×§ ××”×¤×ª×¨×•×Ÿ ××• ×‘×›×œ×œ ×œ× ×œ××¦×•× ×›×œ×•×.</p>
                  
                  <p>×¦× ×™×¢×•×ª ×”×™× ×œ× ×¨×§ ×‘×—×™×¨×” - ×”×™× ××•×¨×— ×—×™×™×. ××‘×œ ×œ××” ×©×–×” ×™×”×™×” ×›×œ ×›×š ××•×¨×›×‘? ×œ××” ×©× ××œ×¥ ×œ×”×ª××•×“×“ ×¢× ×©×¨×•×•×œ×™× ×§×¦×¨×™×, ××—×©×•×¤×™× ×•×—×¦××™×•×ª ×§×¦×¨×•×ª ×©×œ× ××ª××™××•×ª ×œ× ×• ×‘×œ×™ ××¤×©×¨×•×ª ×œ×”×™×× ×¢ ××–×”?</p>
                     <p>×œ××” ×œ×‘×–×‘×– ×–××Ÿ ×™×§×¨ ×œ×¤× ×™ ×›×œ ×—×’, ××•×¢×“ ××• ××™×¨×•×¢ ×›×©×™×© ×¢×•×“ ×›×œ ×›×š ×”×¨×‘×” ××” ×œ×¢×©×•×ª?</p>
                  
                  <p>×¦× ×•×¢×•×ª ×”×•× ×”××§×•× ×©×‘×• ×”×¤×ª×¨×•× ×•×ª × ××¦××™× ×‘××§×•× ××—×“. ××‘×œ ×›×“×™ ×©×–×” ×™×¢×‘×•×“, ×× ×™ ×¦×¨×™×›×” ××ª ×”×¢×–×¨×” ×©×œ×›×Ÿ. ×”××ª×¨ ××‘×•×¡×¡ ×¢×œ ×©×™×ª×•×£ - ×›×œ ××©×ª××©×ª ×™×›×•×œ×” ×œ×”×•×¡×™×£ ×§×™×©×•×¨×™× ×œ×¤×¨×™×˜×™× ××ª××™××™× ×•×œ×¡××Ÿ:</p>
                  
                  <ul>
                      <li>××•×¨×š ×©×¨×•×•×œ</li>
                      <li>××•×¨×š ×—×¦××™×ª</li>
                      <li>×¡×•×’ ×¦×•×•××¨×•×Ÿ</li>
                      <li>×›×™×¡×™× (×›×™ ××™ ×œ× ××•×”×‘×ª ×›×™×¡×™×? ğŸ˜Œ)</li>
                  </ul>
                  
                  <p>×‘×œ×™ ×”×ª×¨×•××” ×©×œ×›×Ÿ - ×”×§×™×©×•×¨×™×, ×”×“×™×¨×•×’×™× ×•×”×¤×™×“×‘×§ - ×”××ª×¨ ×œ× ×™×•×›×œ ×œ×ª×¤×§×“. ×”×™×“×¢ ×•×”××•××—×™×•×ª ×©×œ×›×Ÿ ×”× ××” ×©×”×•×¤×š ××ª ×–×” ×œ××¢×©×™ ×•×××™×Ÿ.</p>
                  
                  <h3>×”×—×–×•×Ÿ ×©×œ×™?</h3>
                  <p>×× ×™ ×¨×•×¦×” ×©×›×œ ××—×ª ×ª×•×›×œ ×œ××¦×•× ××” ×©×”×™× ××—×¤×©×ª ×‘×§×œ×•×ª, ×‘×œ×™ ×œ×”×ª×¤×©×¨ ×¢×œ ×”×¢×¨×›×™× ×©×œ×”. ×œ×”×¤×•×š ××ª ×”×—×™×¤×•×© ×œ×—×•×•×™×” × ×¢×™××” ×‘××§×•× ×œ×××‘×§ ×™×•××™×•××™.</p>
                  
                  <p><strong>×‘×•××• × ×¢×©×” ××ª ×–×” ×‘×™×—×“ - ×‘×”×“×“×™×•×ª.</strong></p>
                  
                  <div class="contact-section">
                      <h3>×™×¦×™×¨×ª ×§×©×¨</h3>
                      <p>×œ×©××œ×•×ª, ×”×¢×¨×•×ª ×•×”×¦×¢×•×ª: <a href="mailto:katz.odlia@gmail.com">katz.odlia@gmail.com</a></p>
                  </div>
              </div>
          </div>
      </section>
  </main>

  <!-- Accessibility Controls -->
  <div class="accessibility-controls">
      <button id="theme-toggle" class="accessibility-btn" title="×”×—×œ×¤×ª ××¦×‘ ×›×”×”/×‘×”×™×¨">â¾</button>
      <button id="font-size-toggle" class="accessibility-btn" title="×©×™× ×•×™ ×’×•×“×œ ×˜×§×¡×˜">A</button>
      <button id="contrast-toggle" class="accessibility-btn" title="×©×™×¤×•×¨ × ×™×’×•×“×™×•×ª">C</button>
  </div>

  <!-- Light Animation -->
  <div id="let-there-be-light" class="light-animation">×•×™×”×™ ××•×¨</div>

 
// ××¢×¨×›×™× ×¨×™×§×™× - ××™×Ÿ ×“××•
let currentItems = [];
let currentForumPosts = [];
let currentQuotes = [];

// ×–××Ÿ ×”×ª×—×œ×ª ××™×œ×•×™ ×˜×•×¤×¡ (×œ×”×’× ×” ×¢×œ ×¡×¤××)
let formStartTime = Date.now();

// ××ª×—×•×œ ×”××¤×œ×™×§×¦×™×”
document.addEventListener('DOMContentLoaded', initializeApp);
function initializeApp() {
    loadUserSettings();
    setupEventListeners();
    loadDataFromStorage();
    setupCaptcha();
    renderItems();
    renderForumPosts();
    renderTzniutQuotes();
}

// ----------------- × ×’×™×©×•×ª -----------------
function setupEventListeners() {
    // ×›×¤×ª×•×¨×™ × ×’×™×©×•×ª
    document.getElementById('theme-toggle')?.addEventListener('click', toggleTheme);
    document.getElementById('font-size-toggle')?.addEventListener('click', toggleFontSize);
    document.getElementById('contrast-toggle')?.addEventListener('click', toggleContrast);

    // × ×™×•×•×˜
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.addEventListener('click', () => switchTab(btn.dataset.tab));
    });

    // ×˜×¤×¡×™×
    document.getElementById('add-item-form')?.addEventListener('submit', handleAddItem);
    document.getElementById('ask-question-btn')?.addEventListener('click', showQuestionForm);
    document.getElementById('ask-question-form')?.addEventListener('submit', handleQuestionSubmit);

    // ××¡× × ×™×
    ['sleeve-filter', 'skirt-filter', 'collar-filter', 'pockets-filter'].forEach(id => {
        document.getElementById(id)?.addEventListener('change', applyFilters);
    });
}

function toggleTheme() {
    const current = document.body.dataset.theme || 'light';
    const next = current === 'light' ? 'dark' : 'light';
    document.body.dataset.theme = next;
    document.getElementById('theme-toggle').textContent = next === 'light' ? 'â¾' : 'âœ¹';
    localStorage.setItem('theme', next);
    showNotification(`××¢×‘×¨ ×œ××¦×‘ ${next === 'light' ? '×‘×”×™×¨' : '×›×”×”'}`);
    if (current === 'dark' && next === 'light') animateLightTransition();
}

function animateLightTransition() {
    const el = document.getElementById('let-there-be-light');
    if (!el) return;
    el.style.display = 'block';
    el.classList.remove('animate');
    void el.offsetWidth; // force reflow
    el.classList.add('animate');
    setTimeout(() => {
        el.classList.remove('animate');
        el.style.display = 'none';
    }, 1600);
}

function toggleFontSize() {
    const sizes = ['normal', 'small', 'large', 'extra-large'];
    const current = document.body.dataset.fontSize || 'normal';
    const idx = sizes.indexOf(current);
    const next = sizes[(idx + 1) % sizes.length];
    document.body.dataset.fontSize = next;
    localStorage.setItem('fontSize', next);
    showNotification(`×’×•×“×œ ×˜×§×¡×˜: ${getSizeLabel(next)}`);
}

function toggleContrast() {
    const current = document.body.dataset.contrast || 'normal';
    const next = current === 'normal' ? 'high' : 'normal';
    document.body.dataset.contrast = next;
    localStorage.setItem('contrast', next);
    showNotification(`× ×™×’×•×“×™×•×ª ${next === 'high' ? '×’×‘×•×”×”' : '×¨×’×™×œ×”'}`);
}

function loadUserSettings() {
    const theme = localStorage.getItem('theme') || 'light';
    const fontSize = localStorage.getItem('fontSize') || 'normal';
    const contrast = localStorage.getItem('contrast') || 'normal';
    document.body.dataset.theme = theme;
    document.body.dataset.fontSize = fontSize;
    document.body.dataset.contrast = contrast;
    document.getElementById('theme-toggle').textContent = theme === 'light' ? 'â¾' : 'âœ¹';
}

// ----------------- × ×™×•×•×˜ -----------------
function switchTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
    document.getElementById(tabId)?.classList.add('active');
    document.querySelector(`[data-tab="${tabId}"]`)?.classList.add('active');
    if (tabId === 'gallery') renderItems();
    if (tabId === 'forum') renderForumPosts();
    if (tabId === 'tzniut-forum') renderTzniutQuotes();
}

// ----------------- ×’×œ×¨×™×” -----------------
function renderItems(itemsToRender = currentItems) {
    const grid = document.getElementById('items-grid');
    if (!grid) return;
    if (itemsToRender.length === 0) {
        grid.innerHTML = '<div class="no-results">×œ× × ××¦××• ×¤×¨×™×˜×™× - ×”×•×¡×™×¤×™ ××ª ×”×‘×’×“ ×”×¨××©×•×Ÿ!</div>';
        return;
    }
    grid.innerHTML = itemsToRender.map(item => `
        <div class="item-card">
            <div class="item-title">${item.title || '×‘×’×“ ×œ×œ× ×©×'}</div>
            <div class="item-details">
                <span class="item-tag">×©×¨×•×•×œ×™×: ${getHebrewValue('sleeve', item.sleeve_length)}</span>
                <span class="item-tag">×—×¦××™×ª: ${getHebrewValue('skirt', item.skirt_length)}</span>
                <span class="item-tag">×¦×•×•××¨×•×Ÿ: ${getHebrewValue('collar', item.collar_type)}</span>
                ${item.has_pockets ? '<span class="item-tag">âœ“ ×›×™×¡×™×</span>' : ''}
            </div>
            <div class="item-rating" data-item-id="${item.id}">
                ${generateStars(item.rating || 0, item.id)}
            </div>
            <div class="item-comments">
                ${(item.comments || []).map(comment => `<div class="comment">${comment}</div>`).join('')}
                <div class="add-comment">
                    <input type="text" placeholder="×”×•×¡×™×¤×™ ×”×¢×¨×”..." data-item-id="${item.id}">
                    <button onclick="addComment(${item.id})">×©×œ×—×™</button>
                </div>
            </div>
            ${item.url ? `<a href="${item.url}" target="_blank" class="btn btn-primary" style="margin-top: 15px;">×¦×¤×™ ×‘××ª×¨ ×”××§×•×¨×™</a>` : ''}
        </div>
    `).join('');
    setupStarRatings();
}

function generateStars(rating, itemId) {
    let stars = '';
    for (let i = 1; i <= 5; i++) {
        const active = i <= rating ? 'active' : '';
        stars += `<span class="star ${active}" data-rating="${i}" data-item-id="${itemId}">â˜…</span>`;
    }
    return stars;
}

function setupStarRatings() {
    document.querySelectorAll('.star').forEach(star => {
        star.addEventListener('click', function() {
            const rating = parseInt(this.dataset.rating);
            const itemId = parseInt(this.dataset.itemId);
            updateItemRating(itemId, rating);
        });
    });
}

function updateItemRating(itemId, rating) {
    const item = currentItems.find(i => i.id === itemId);
    if (item) {
        item.rating = rating;
        renderItems();
        saveDataToStorage();
        showNotification('×“×™×¨×•×’ × ×©××¨ ×‘×”×¦×œ×—×”!');
    }
}

function addComment(itemId) {
    const input = document.querySelector(`input[data-item-id="${itemId}"]`);
    const comment = input.value.trim();
    if (comment) {
        const item = currentItems.find(i => i.id === itemId);
        if (item) {
            if (!item.comments) item.comments = [];
            item.comments.push(comment);
            input.value = '';
            renderItems();
            saveDataToStorage();
            showNotification('×”×¢×¨×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”!');
        }
    }
}

function applyFilters() {
    const sleeveFilter = document.getElementById('sleeve-filter')?.value;
    const skirtFilter = document.getElementById('skirt-filter')?.value;
    const collarFilter = document.getElementById('collar-filter')?.value;
    const pocketsFilter = document.getElementById('pockets-filter')?.value;
    let filteredItems = currentItems.filter(item => {
        const sleeveMatch = !sleeveFilter || item.sleeve_length === sleeveFilter;
        const skirtMatch = !skirtFilter || item.skirt_length === skirtFilter;
        const collarMatch = !collarFilter || item.collar_type === collarFilter;
        const pocketsMatch = !pocketsFilter ||
            (pocketsFilter === 'yes' && item.has_pockets) ||
            (pocketsFilter === 'no' && !item.has_pockets);
        return sleeveMatch && skirtMatch && collarMatch && pocketsMatch;
    });
    renderItems(filteredItems);
}

// ----------------- ×˜×•×¤×¡ ×”×•×¡×¤×ª ×‘×’×“ -----------------
function handleAddItem(e) {
    e.preventDefault();
    if (!validateFormSecurity('item')) return;
    const formData = {
        id: Date.now(),
        title: document.getElementById('item-title').value.trim(),
        url: document.getElementById('item-url').value.trim(),
        sleeve_length: document.getElementById('sleeve-length').value,
        skirt_length: document.getElementById('skirt-length').value,
        collar_type: document.getElementById('collar-type').value,
        has_pockets: document.getElementById('has-pockets').checked,
        description: document.getElementById('item-description').value.trim(),
        rating: 0,
        comments: []
    };
    currentItems.push(formData);
    document.getElementById('add-item-form').reset();
    saveDataToStorage();
    setupCaptcha();
    formStartTime = Date.now();
    switchTab('gallery');
    showNotification('×‘×’×“ × ×•×¡×£ ×‘×”×¦×œ×—×”!');
}

// ----------------- ×¤×•×¨×•× -----------------
function showQuestionForm() {
    document.getElementById('ask-question-form').style.display = 'block';
    setupCaptcha();
    formStartTime = Date.now();
}

function hideQuestionForm() {
    document.getElementById('ask-question-form').style.display = 'none';
    document.getElementById('question-title').value = '';
    document.getElementById('question-content').value = '';
}

function handleQuestionSubmit(e) {
    e.preventDefault();
    if (!validateFormSecurity('question')) return;
    const title = document.getElementById('question-title').value.trim();
    const content = document.getElementById('question-content').value.trim();
    if (!title || !content) {
        showNotification('×× × ××œ××™ ××ª ×›×œ ×”×©×“×•×ª');
        return;
    }
    const newPost = {
        id: Date.now(),
        title: title,
        content: content,
        answers: [],
        date: new Date().toLocaleDateString('he-IL')
    };
    currentForumPosts.unshift(newPost);
    renderForumPosts();
    hideQuestionForm();
    saveDataToStorage();
    showNotification('×©××œ×” ×¤×•×¨×¡××” ×‘×”×¦×œ×—×”!');
}

function renderForumPosts() {
    const container = document.getElementById('forum-posts');
    if (!container) return;
    if (currentForumPosts.length === 0) {
        container.innerHTML = '<div class="no-results">×¢×“×™×™×Ÿ ××™×Ÿ ×©××œ×•×ª ×‘×¤×•×¨×•×. ×”×™×™ ×”×¨××©×•× ×” ×œ×©××•×œ!</div>';
        return;
    }
    container.innerHTML = currentForumPosts.map(post => `
        <div class="forum-post">
            <h3>${post.title}</h3>
            <div class="forum-post-content">${post.content}</div>
            <small>×¤×•×¨×¡× ×‘: ${post.date}</small>
            <div class="forum-answers">
                ${post.answers.map(answer => `<div class="forum-answer">${answer}</div>`).join('')}
                <div class="add-answer">
                    <input type="text" placeholder="×›×ª×‘×™ ×ª×©×•×‘×”..." data-post-id="${post.id}">
                    <button onclick="addAnswer(${post.id})">×©×œ×—×™</button>
                </div>
            </div>
        </div>
    `).join('');
}

function addAnswer(postId) {
    const input = document.querySelector(`input[data-post-id="${postId}"]`);
    const answer = input.value.trim();
    if (answer) {
        const post = currentForumPosts.find(p => p.id === postId);
        if (post) {
            post.answers.push(answer);
            input.value = '';
            renderForumPosts();
            saveDataToStorage();
            showNotification('×ª×©×•×‘×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”!');
        }
    }
}

// ----------------- ×¤×•×¨×•× ×¦× ×™×¢×•×ª -----------------
function renderTzniutQuotes() {
    const container = document.getElementById('tzniut-quotes');
    if (!container) return;
    if (currentQuotes.length === 0) {
        container.innerHTML = '<div class="no-results">×¢×“×™×™×Ÿ ××™×Ÿ ×¦×™×˜×•×˜×™× ×‘×¤×•×¨×•×. ×”×•×¡×™×¤×™ ××ª ×”×¨××©×•×Ÿ!</div>';
        return;
    }
    container.innerHTML = currentQuotes.map(quote => `
        <div class="quote-card">
            <div class="quote-text">"${quote.text}"</div>
            <div class="quote-author">â€” ${quote.author}</div>
            ${quote.source ? `<small style="color: var(--text-muted);">${quote.source}</small>` : ''}
            <div class="quote-comments">
                ${quote.comments.map(comment => `<div class="quote-comment">${comment}</div>`).join('')}
                <div class="add-quote-comment">
                    <input type="text" placeholder="×”×•×¡×™×¤×™ ×ª×’×•×‘×”..." data-quote-id="${quote.id}">
                    <button onclick="addQuoteComment(${quote.id})">×©×œ×—×™</button>
                </div>
            </div>
        </div>
    `).join('');
}

function addQuoteComment(quoteId) {
    const input = document.querySelector(`input[data-quote-id="${quoteId}"]`);
    const comment = input.value.trim();
    if (comment) {
        const quote = currentQuotes.find(q => q.id === quoteId);
        if (quote) {
            quote.comments.push(comment);
            input.value = '';
            renderTzniutQuotes();
            saveDataToStorage();
            showNotification('×ª×’×•×‘×” × ×•×¡×¤×” ×‘×”×¦×œ×—×”!');
        }
    }
}

// ----------------- ×¢×–×¨ -----------------
function getHebrewValue(type, value) {
    const translations = {
        sleeve: { 'long': '××¨×•×š', '3quarter': '3/4', 'short': '×§×¦×¨', 'none': '×œ×œ×' },
        skirt: { 'long': '××¨×•×›×”', 'midi': '××™×“×™', 'short': '×§×¦×¨×”', 'none': '×œ×œ×' },
        collar: { 'high': '×’×‘×•×”', 'round': '×¢×’×•×œ', 'v': '×•×™', 'none': '×œ×œ×' }
    };
    return translations[type]?.[value] || value;
}

function getSizeLabel(size) {
    return { 'small': '×§×˜×Ÿ', 'normal': '×¨×’×™×œ', 'large': '×’×“×•×œ', 'extra-large': '×’×“×•×œ ×××•×“' }[size] || '×¨×’×™×œ';
}

function showNotification(message) {
    document.querySelectorAll('.notification').forEach(n => n.remove());
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 3000);
}

// ----------------- ×©××™×¨×ª × ×ª×•× ×™× -----------------
function saveDataToStorage() {
    try {
        localStorage.setItem('tzanuot-items', JSON.stringify(currentItems));
        localStorage.setItem('tzanuot-forum-posts', JSON.stringify(currentForumPosts));
        localStorage.setItem('tzanuot-quotes', JSON.stringify(currentQuotes));
    } catch (error) {
        console.error('×©×’×™××” ×‘×©××™×¨×ª ×”× ×ª×•× ×™×:', error);
    }
}

function loadDataFromStorage() {
    try {
        const savedItems = localStorage.getItem('tzanuot-items');
        const savedPosts = localStorage.getItem('tzanuot-forum-posts');
        const savedQuotes = localStorage.getItem('tzanuot-quotes');
        if (savedItems) currentItems = JSON.parse(savedItems);
        if (savedPosts) currentForumPosts = JSON.parse(savedPosts);
        if (savedQuotes) currentQuotes = JSON.parse(savedQuotes);
        renderItems();
        renderForumPosts();
        renderTzniutQuotes();
    } catch (error) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×:', error);
        showNotification('×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™× ×”×©××•×¨×™×');
    }
}

// ----------------- ×§××¤×¦'×” ×•×”×’× ×ª ×‘×•×˜×™× -----------------
function setupCaptcha() {
    generateCaptcha('captcha-question', 'captcha-answer');
    generateCaptcha('question-captcha-question', 'question-captcha-answer');
}

function generateCaptcha(questionElementId, answerElementId) {
    const questionElement = document.getElementById(questionElementId);
    const answerElement = document.getElementById(answerElementId);
    if (!questionElement || !answerElement) return;
    const num1 = Math.floor(Math.random() * 10) + 1;
    const num2 = Math.floor(Math.random() * 10) + 1;
    const operation = Math.random() > 0.5 ? '+' : '-';
    let question, answer;
    if (operation === '+') {
        question = `${num1} + ${num2} = ?`;
        answer = num1 + num2;
    } else {
        const larger = Math.max(num1, num2);
        const smaller = Math.min(num1, num2);
        question = `${larger} - ${smaller} = ?`;
        answer = larger - smaller;
    }
    questionElement.textContent = question;
    questionElement.dataset.answer = answer;
    answerElement.value = '';
}

function validateCaptcha(questionElementId, answerElementId) {
    const questionElement = document.getElementById(questionElementId);
    const answerElement = document.getElementById(answerElementId);
    if (!questionElement || !answerElement) return false;
    const correctAnswer = parseInt(questionElement.dataset.answer);
    const userAnswer = parseInt(answerElement.value);
    return correctAnswer === userAnswer;
}

function validateFormSecurity(formType = 'item') {
    // Honeypot
    const websiteField = document.getElementById('website');
    if (websiteField && websiteField.value) {
        showNotification('×©×’×™××” ×‘×©×œ×™×—×”. ×× × × ×¡×™ ×©×•×‘.');
        return false;
    }
    // ×–××Ÿ ××™×œ×•×™ ×˜×•×¤×¡
    if (Date.now() - formStartTime < 3000) {
        showNotification('×× × ×”××ª×™× ×™ ××¡×¤×¨ ×©× ×™×•×ª ×œ×¤× ×™ ×”×©×œ×™×—×”.');
        return false;
    }
    // ×§××¤×¦'×”
    const questionId = formType === 'item' ? 'captcha-question' : 'question-captcha-question';
    const answerId = formType === 'item' ? 'captcha-answer' : 'question-captcha-answer';
    if (!validateCaptcha(questionId, answerId)) {
        showNotification('×ª×©×•×‘×” ×©×’×•×™×” ×œ×‘×¢×™×” ×”××ª××˜×™×ª. × ×¡×™ ×©×•×‘.');
        setupCaptcha();
        return false;
    }
    return true;
}
